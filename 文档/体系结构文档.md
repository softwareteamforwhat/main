# 软件体系结构文档V1.0

## 文档修改历史

| 修改人员 | 日期      | 修改原因                   | 版本号 |
| :------: | --------- | -------------------------- | ------ |
|  呼斯楞  | 2019/4/7  | 第一次设计                 | V1.0   |
|  呼斯楞  | 2019/4/14 | 需求从第一阶段调到一二阶段 | V2.0   |
|  呼斯楞  | 2019/4/19 | 例会之后的修改             | V2.1.1 |
|  呼斯楞  | 2019/4/19 | V2版本的最终稿             | V2.1.2 |
|  呼斯楞  | 2019/6/13 | 新增了第三阶段             | V3.0   |

## 目录

目前文档未实体化，故略。

## 1.引言

### 1.1编制目的

* 为了完成第一、二阶段的开发，根据用例文档和需求规格说明文档完成体系结构文档，方便后期开发。

* 本文档详细完成对电影院管理系统第一、二阶段的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员以及用户的沟通。

* 本文档面向开发人员、测试人员以及最终用户编写，是了解系统的导航。

### 1.2词汇表

| 词汇名称 | 词汇含义                                           | 备注                                                         |
| :------: | -------------------------------------------------- | ------------------------------------------------------------ |
|   CMS    | 电影院管理系统                                     | Cinema Manager System的缩写                                  |
|   API    | Application Programming Interface,应用程序编程接口 | 是一些预先定义的函数，目的是提供应用程序与开发人员基于某软件或硬件得以访问一组例程的能力，而又无需访问源码，或理解内部工作机制的细节。 |
|   JDBC   | Java DataBase Connectivity,java数据库连接          | 是一种用于执行SQL语句的Java API，可以为多种关系数据库提供统一访问，它由一组用Java语言编写的类和接口组成。JDBC提供了一种基准，据此可以构建更高级的工具和接口，使数据库开发人员能够编写数据库应用程序。|

### 1.3参考资料

用例文档V2.0

需求规格说明文档V2.0

## 2.产品概述

​	参考电影院管理系统的用例文档和需求规格说明文档中对产品的概括描述。

## 3.逻辑视图

- 处理静态设计模型

  - 电影院管理系统选择了分层体系结构风格，将系统分为展示层、逻辑层、数据层三层以展示高层抽象。展示层包含GUI页面的实现，逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。下面的示意图展示了逻辑视角和逻辑设计。

- 示意图
![逻辑视角](http://image-of-hsl.oss-cn-shenzhen.aliyuncs.com/logicalPerspectiveDiagram.jpg)
![逻辑设计](http://image-of-hsl.oss-cn-shenzhen.aliyuncs.com/LogicDesignDiagram.jpg)

## 4.组合视图

### 4.1开发包图

|      开发包      | 依赖的其他开发包                                             |
| :--------------: | ------------------------------------------------------------ |
|      mainui      | userui、cinemaui、movieui、promotionui、purchaseui、memberui、vo |
|      userui      | userblservice,界面类库包                                     |
|  userblservice   |                                                              |
|      userbl      | UserInterface,UserDataClient,UserPO                          |
| userdataservice |  |
|     userdata     | po,databaseutility,|
|     cinemaui     | cinemablservice,界面类库包                               |
|  cinemablservice  |                                                              |
|     cinemabl     | cinemablservic,cinemadataservice,po,moviebl               |
| cinemadataservice | po,http                                                      |
|    cinemadata    | po,databaseutility,cinemadataservice                 |
|     movieui     | movieblservice,界面类库包                                    |
|  movieblservice  |                                                              |
|     moviebl      | movieblservic,|
| MenberDataService | |
|    moviedata     | po,databaseutility,|
|     purchaseui     | purchaseblservice,界面类库包                            |
|  purchaseblservice  |                                                              |
|  purchasebl | purchaseblservice,purchasedataservice,po,promotionbl,cinemabl,memberbl，userbl |
| purchasedataservice | po,http                                                      |
| purchasedata | po,databaseutility,purchasedataservice              |
|     promotionui     | promotionblservice,界面类库包                           |
|  promotionblservice  |                                                              |
| promotionbl | promotionblservic,promotiondataservice,po,userbl |
| promotiondataservice | po,http                                                      |
| promotiondata | po,databaseutility,promotiondataservice             |
|     memberui     | memberblservice,界面类库包                     |
|  memberblservice  |                                                              |
|    memberbl | memberblservic,memberdataservice,po,userbl       |
| memberdataservice | po,http                                                      |
|  memberdata | po,databaseutility,memberdataservice                |
| promotionStrategyui | promotionStrategyblservice,界面类库包 |
| promotionStrategyblservice |  |
| promotionStrategybl | promotionStrategyblservice,promotionStrategydataservice,po, |
| promotionStrategydataservice | po,http |
| promotionStrategydata | po,databaseutility,promotionStrategydataservice |
| viphistoryui | viphistoryblservice,界面类库包 |
| viphistoryblservice | |
| viphistorybl | viphistoryblservice,viphistoryStrategydateservice,po |
| viphistorydataservice | po,http |
| viphistorydata | po,databaseutility,viphistorydataservice |
| vo | |
|        po         |                                                              |
|    uitilitybl     |                                                              |
|    界面类库包     |                                                              |
|       http        |                                                              |
|  databaseutility  | JDBC                                                         |
| datafactoryservice | http |

* 电影院管理系统客户端开发包图
![开发包图](http://image-of-hsl.oss-cn-shenzhen.aliyuncs.com/pkgDiagram.jpg)
*  电影院管理系统服务器端开发包图
![开发包图2](http://image-of-hsl.oss-cn-shenzhen.aliyuncs.com/pkgDiagram2.jpg)

### 4.2运行时进程

- 在电影院管理系统中，会有多个客户端进程和一个服务器端进程，其进程图如下。

- 示意图|

  ![进程图](http://image-of-hsl.oss-cn-shenzhen.aliyuncs.com/ProcessDiagram.jpg)


### 4.3物理部署

- 处理如何将软件组件映射到硬件基础设施

  电影院管理系统中的客户端以网页的形式体现，服务器端构件放在服务器端机器上。客户端节点就是浏览器端节点。部署图如下

- 示意图|

  ![部署图](http://image-of-hsl.oss-cn-shenzhen.aliyuncs.com/DeploymentDiagram.jpg)

## 5.架构设计

### 5.1模块职责

- 模块视图

  ![ModelView](http://image-of-hsl.oss-cn-shenzhen.aliyuncs.com/ModelView.jpg)

- 各层职责

|        层        | 职责                                       |
| :--------------: | ------------------------------------------ |
|    用户界面层    | 基于网页的电影院管理系统界面               |
|    业务逻辑层    | 对于用户的输入进行响应，并进行业务逻辑处理 |
|  客户端网络模块  | 利用http从服务器获取信息                   |
|  客户端启动模块  | 初始化系统，启动用户界面                   |
| 服务器端启动模块 | 初始化无网络通信机制，启动用户界面         |
|      数据层      | 负责数据持久化以及数据访问接口             |
| 服务器端网络模块 | 利用http响应客户端的要求                   |

- 层之间调用接口

|接口  | 服务调用方       | 服务提供方       |
| :----------------------------------------------------------:|---------------- | ---------------- |
| MovieBLService<br>LoginBLService<br>CinemaBLService<br>PurchaseBLService<br>PromotionBLService<br>MemberBLService<br> | 客户端展示层     | 客户端业务逻辑层|
| DatabaseFactory<br>UserDataService<br>CinemaDataService<br>PurchaseDataService<br>PromotionDataService<br>MemberDataService<br> | 客户端业务逻辑层 | 服务器端数据层   |



### 5.2用户界面层分解

#### 5.2.1职责

| 模块                   |                             职责                             |
| :--------------------- | :----------------------------------------------------------: |
| PromotionStrategyFrame |             界面Frame，赠送优惠券和管理优惠策略              |
| VipHistoryFrame        |              界面Frame，查看会员卡充值/消费记录              |
| MainFrame              |                界面Frame,负责界面的显示和跳转                |
| MemberFrame            | 界面Frame,显示会员卡信息，会员卡购买和会员卡充值的选项，支付信息 |
| PromotionFrame         |  界面Frame,显示增加优惠政策的选项，已经存在的优惠政策的信息  |
| PurchaseFrame          |          界面Frame,显示购票选项，订单信息，支付信息          |
| UserFrame              |            界面Frame,显示用户的用户名，身份等信息            |
| MovieFrame             | 界面Frame,显示电影列表，电影详情，电影统计信息，并提供上架电影的选项 |
| CinemaFrame            |       界面Frame,显示电影排片信息，并提供电影排片的选项       |

#### 5.2.2接口规范
||||
| :--- |:----|-----|
|PromotionStrategyFrame|语法|init(args:String[])|
||前置条件|无|
||后置条件|显示赠送优惠券和修改优惠策略的选项|
|VipHistoryFrame|语法|init(args:String[])|
||前置条件|无|
||后置条件|显示会员卡充值和消费记录|
|MemberFrame|语法|init(args:String[])|
||前置条件|无|
||后置条件|显示会员卡信息，会员卡购买和会员卡充值的选项，支付信息|
|PurchaseFrame|语法|init(args:String[])|
||前置条件|无|
||后置条件|显示购票选项，订单信息，支付信息|
|PromotionFrame|语法|init(args:String[])|
||前置条件|无|
||后置条件|显示增加优惠政策的选项，已经存在的优惠政策的信息|
|UserFrame|语法|init(args:String[])|
||前置条件|无|
||后置条件|显示用户的用户名，身份等信息|
|MovieFrame|语法|init(args:String[])|
||前置条件|无|
||后置条件|显示电影列表，电影详情，电影统计信息，并提供上架电影的选项|
|CinemaFrame|语法|init(args:String[])|
||前置条件|无|
||后置条件|显示电影排片信息，并提供电影排片的选项|
#### 5.2.3用户界面层模块需要的服务接口  
|服务名|服务|
|:----|:----|
|businesslogicservice.PromotionStrategyBLService|优惠策略管理界面的业务逻辑接口|
|businesslogicservice.VipHistoryBLService|会员卡记录界面的业务逻辑接口|
|businesslogicservice.LoginBLService|登陆界面的业务逻辑接口|
|businesslogicservice.UserBLService|用户界面的业务逻辑接口|
|businesslogicservice.MovieBLService|登陆界面的业务逻辑接口|
|businesslogicservice.PromotionBLService|用户界面的业务逻辑接口|
|businesslogicservice.PurchaseBLService|登陆界面的业务逻辑接口|
|businesslogicservice.MemberBLService|用户界面的业务逻辑接口|
|businesslogicservice.CinemaBLService|登陆界面的业务逻辑接口|
### 5.3业务逻辑层分解

#### 5.3.1职责

| 模块                | 职责                               |
| ------------------- | ---------------------------------- |
| userbl              | 负责实现对应与登录界面所需要的服务 |
| cinemabl            | 负责实现影院界面需要的服务         |
| moviebl             | 负责实现电影界面需要的服务         |
| purchasebl          | 负责实现购票界面需要的服务         |
| promotionstrategybl | 负责实现优惠策略界面需要的服务     |
| viphistorybl        | 负责实现会员卡记录界面需要的服务   |
| promotionbl         | 负责实现促销界面需要的服务         |
| memberbl            | 负责实现会员界面需要的服务         |




#### 5.3.2接口规范
##### 5.3.2.1promotionbl模块的接口规范
|提供的服务|||
|:----:|----|----|
|Promotion.addPromotion|语法|public ResultMessage addPromotion(String activityTime,String trueTime,long num, String conditions)|
||前置条件|启动一个发布优惠活动环节，所有输入符合规则|
||后置条件|结束此次优惠活动发布的环节，持久化更新涉及的领域对象的数据|
|Promotion.getUserPromotion|语法|public ResultMessage getUserPromotion（long userID）|
||前置条件|Purchase发出获得优惠策略的请求|
||后置条件|返回该用户具有的优惠信息|
|Promotion.setUserPromotion|语法|public ResultMessage setUserPromotion（long userID,long PromotionPoId）|
||前置条件|Purchase发出更改用户持有的优惠券信息的请求|
||后置条件|持久化更新涉及的领域对象的数据|

|需要的服务||
|:----:|----|
|PromotionDataService.find(int id)|根据ID进行查找单一持久对象|
|PromotionDataService.finds(String field,int value)|根据字段名和值进行查找多个持久对象|
|PromotionDataService.insert(PromotionPO po)|插入单一持久对象|
|PromotionDataService.delete(PromotionPO po)|删除单一持久对象|
|PromotionDataService.update(PromotionPO po)|更新单一持久对象|
|DatabaseFactory.getPromotionDatabase|得到Promotion的数据库服务的引用|
|User.getCurrentUserId()|获得当前用户的ID|
##### 5.3.2.2purchasebl模块的接口规范
|提供的服务|||
|:----:|----|----|
|Purchase.getMovieInformation|语法|public ResultMessage getMovieInformation(long MovieId)|
||前置条件|启动一个购买电影票环节 |
||后置条件|返回系统需要显示的某一电影场次信息|
|Purchase.getSeatInformation:|语法|public ResultMessage getSeatInformation(long MovieId,long YingTingId)|
||前置条件|启动一个选座环节 输入合法|
||后置条件|返回系统需要显示的选座信息|
|Purchase.addSeatInformation|语法|public ResultMessage addSeatInformation(String seatMessage)|
||前置条件|已经启动一次购票环节|
||后置条件|返回订单信息，包括价格，座位信息，时间信息，影片信息，并且锁定座位信息|
|Purchase.check|语法|public ResultMessage check(String password)|
||前置条件|用户选择会员卡支付|
||后置条件|返回支付验证的结果|
|Purchase.end|语法|public void end()|
||前置条件|已支付|
||后置条件|结束此次购票环节|
|Purchase.cancel|语法|public ResultMessge cancel()|
||前置条件|座位信息已被锁定|
||后置条件|解锁座位信息|
|Purchase.addException()|语法|public void addException(Exception e)|
||前置条件|用户选择稍后支付或支付时异常退出|
||后置条件|订单保留待支付状态15分钟，超时未支付则自动取消订单|

|需要的服务||
|:----:|----|
|PurchaseDataService.find(int id)|根据ID进行查找单一持久对象|
|	PurchaseDataService.finds(String field,int value)|根据字段名和值进行查找多个持久对象|
|	PurchaseDataService.insert(PromotionPO po)|插入单一持久对象|
|	PurchaseDataService.delete(PromotionPO po)|删除单一持久对象|
|	PurchaseDataService.update(PromotionPO po)|更新单一持久对象|
|	DatabaseFactory.getPurchaseDatabase|得到Purchase的数据库服务的引用|
|  Promotion.getUserPromotion(long userID)|得到购票用户具有的优惠信息|
|Promotion.setUserPromotion(long userId,long PromotionPoId)|在购票结束后改变观众具有的优惠券信息|
|Member.payPurchase(String password,long userId,long payMoney)|得到用会员卡支付的结果|
|cinemabl.SetChangeseat(List Seat)|调用改变座位信息的方法，在购票进程结束后改变座位信息|
|cinemabl.getSeatInfromation(String startdate, String enddate, long cinemaID)|获得某影厅某一场次电影的座位信息|
|User.getCurrentUserId()|获得当前用户的ID|

##### 5.3.2.3member模块的接口规范
|提供的服务|||
|:----:|----|----|
|Member.getVIPMessage|语法|public ResultMessage getVIPMessage()|
||前置条件|启动一个购买会员卡的环节|
||后置条件|返回会员卡的特权信息，包括价格，充值优惠信息等|
|Member.getMemberInformation|语法|public ResultMessage getMemberInformation(long UserId)|
||前置条件|id存在且输入合法|
||后置条件|返回该id关联的会员信息，包括会员卡余额等|
|Member.putMoney|语法|public ResultMessage putMoney(long putMoney，long payMoney)|
||前置条件|启动一个会员卡充值回合 |
||后置条件|在一个充值回合中，增加充值金额,支付金额的信息|
|Member.endPayment|语法|public resultMessage endPayment()|
||前置条件|已经获得第三方支付平台的支付成功的确认|
||后置条件| 结束此次会员卡购买或者充值环节，持久化更新涉及的领域对象的数据并将更新后的数据返回|
|Member.addException|语法|public void addException(Exception e)|
||前置条件|用户选择稍后支付或支付时异常退出|
||后置条件|订单保留待支付状态15分钟超时未支付则自动取消订单|
|Member.payPurchase|语法|public ResultMessage payPurchase(String password,long userId,long payMoney)|
||前置条件|Purchase发出用会员卡支付的请求|
||后置条件|返回支付验证的结果，并持久化更新涉及的领域对象的数据|

|需要的服务||
|:----:|----|
|MemberDataService.find(int id)|根据ID进行查找单一持久对象|
|MemberDataService.finds(String field,int value)|根据字段名和值进行查找多个持久对象|
|MemberDataService.insert(PromotionPO po)|插入单一持久对象|
|MemberDataService.delete(PromotionPO po)|删除单一持久对象|
|MemberDataService.update(PromotionPO po)|更新单一持久对象|
|DatabaseFactory.getMemberDatabase|得到Purchase的数据库服务的引用|
|User.getCurrentUserId()|获得当前用户的ID|


##### 5.3.2.4cinema模块的接口规范

<table>
    <tr>
        <th colspan="3" align="center">cinemabl 提供的服务(供接口)</th>
    </tr>
    <tr>
        <td rowspan="3" align="center">cinemabl.addInformation</td>
        <td>语法</td>
        <td>public ResultMessage addInformation(String date, cinemaID, long cinemaID, String targetStartdate, String targetEnddate, double cinemaprice)</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个添加排片信息的回合</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在一个添加排片回合中添加电影的排片信息</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">Cinema.getAvailable</td>
        <td>语法</td>
        <td>public ResultMessage getAvailable(String startdate, String enddate)</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个添加排片信息的回合</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在一个添加排片信息的回合中提供可供排片的时间段和影片列表</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">cinemabl.setTime</td>
        <td>语法</td>
        <td>public ResultMessage setTime(String start, String end, String time)</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个添加/修改排片观众可见时间的回合</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在一个添加/修改排片观众可见时间的回合中修改观众可见时间</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">cinemabl.deleteInformation</td>
        <td>语法</td>
        <td>public void deleteInformation(String date, long cinemaID, String targetdate)</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个删除排片信息的回合</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在删除排片信息回合中删除所选择的排片信息</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">cinemabl.resetInformation</td>
        <td>语法</td>
        <td>public ResultMessage resetInformation(String date, long cinemaID, String targetdate)</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个修改排片信息的回合</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在一个修改排片信息的回合中修改排片信息</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">cinemabl.getInformation</td>
        <td>语法</td>
        <td>public ResultMessage getInformation(String start, String end, String time，long cinemaID)</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个修改排片信息的回合</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在一个修改排片信息的回合中提供该日期下该影厅的已排片信息</td>
    </tr>
     <tr>
        <td rowspan="3" align="center">cinemabl.getcinemaInformation</td>
        <td>语法</td>
        <td>public ResultMessage getcinemaInformation(long cinemaID) </td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>purchase模块发出请求</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>提供某一电影的场次信息（起始时间，价格，影厅，版本）</td>
    </tr>
      <tr>
        <td rowspan="3" align="center">cinemabl.getSeatInfromation</td>
        <td>语法</td>
        <td>public ResultMessage getSeatInformation(String startdate, String enddate, long cinemaID) </td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个售票回合</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在一个售票回合中提供一电影某一场次的座位信息</td>
    </tr>
     <tr>
        <td rowspan="3" align="center">cinemabl.SetChangeseat</td>
        <td>语法</td>
        <td>public ResultMessage SetChangeseat(List Seat) </td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个售票回合</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在一个售票回合后改变一电影某一场次的座位信息</td>
    </tr>
</table>



<table>
    <tr>
    <th colspan="2" align="center">cinemabl 需要的服务(需接口)</th>
    </tr>
    <tr>
        <td>服务名</td>
        <td>服务</td>
    </tr>
    <tr>
        <td>CinemaDataService.find(int id)</td>
        <td>得到cinema数据库的服务的引用</td>
    </tr>
    <tr>
        <td>CinemaDataService.insert(cinemaPo po)</td>
        <td>在数据库中插入cinemaPo对象</td>
    </tr>
    <tr>
        <td>CinemaDataService.find(int id)</td>
        <td>根据ID进行查找单一持久化对象</td>
    </tr>
    <tr>
        <td>CinemaDataService.finds(String field,int value)</td>
        <td>根据字段名和值进行查找多个持久化对象</td>
    </tr>
    <tr>
        <td>CinemaDataService.delete(cinemaPO po)</td>
        <td>删除单一持久化对象</td>
    </tr>
    <tr>
        <td>CinemaDataService.update(cinemaPo po)</td>
        <td>更新单一持久化对象</td>
    </tr>
    <tr>
        <td>Moviebl.getMovieInformation(long id)</td>
        <td>获取电影的详细信息<td>
    </tr>

</table>

##### 5.3.2.5user模块的接口规范
<table>
    <tr>
    	<th colspan="3" align="center">userbl 提供的服务(供接口)</th>
    </tr>
    <tr>
        <td rowspan="3" align="center">User.login</td>
        <td>语法</td>
        <td>public ResultMessage login(long id,String password);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>password符合输入规则</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>查找是否存在相应的User，根据输入的password返回登录验证的结果</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">User.register</td>
        <td>语法</td>
        <td>public ResultMessage register(long id,String password);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>username 以及password 符合输入规则</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>查找是否存在相同的username，若有则显示错误，没有则在数据库插入新的UserPo对象</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">User.getUserId</td>
        <td>语法</td>
        <td>public long getUserId();</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>无</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回当前用户的ID</td>
    </tr>
</table>

<table>
    <tr>
        <th colspan="2" align="center">userbl 需要的服务(需接口)</th>
    </tr>
    <tr>
        <td>服务名</td>
        <td>服务</td>
    </tr>
    <tr>
        <td>DatabaseFactory.getUserDatabase</td>
        <td>得到User数据库的服务的引用</td>
    </tr>
    <tr>
        <td>UserDataService.insert(UserPo po)</td>
        <td>在数据库中插入UserPo对象</td>
    </tr>
</table>

##### 5.3.2.6movie模块的接口规范
<table>
    <tr>
        <th colspan="3" align="center">moviebl 提供的服务(供接口)</th>
    </tr>
    <tr>
        <td rowspan="3" align="center">moviebl.getMovieInformation</td>
        <td>语法</td>
        <td>public MoviePo getMovie(long id)</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>观众选择一部电影查看详情</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回电影详情，包括名称、电影宣传海报、导演、编剧、主演、类型、制片国家/地区、语言、上映日期、片长</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">moviebl.like</td>
        <td>语法</td>
        <td>public void like(long id);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>用户选择一部电影查看详情，并标记为想看</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>将对应用户以及对应想看电影记录在数据库，系统显示已标记，并修改状态为想看</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">moviebl.getStatisticInformation</td>
        <td>语法</td>
        <td>public StatisticInformationPo getStatisticInformation(long id,long id);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>用户请求查看电影各项统计数据</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回用户所选择的统计数据</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">moviebl.addMovie</td>
        <td>语法</td>
        <td>public ResultMessage addMovie(long id,String name,...);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>启动一个上架电影进程</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>在一个上架电影进程中，增加电影信息</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">moviebl.countAllLike</td>
        <td>语法</td>
        <td>public int countAllLike();</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>已添加想看人数信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回所有电影截止当前时间的想看人数</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">moviebl.countLike</td>
        <td>语法</td>
        <td>public int countLike(long id);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>已添加想看人数信息</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回目标电影的自上架到当前时间每日想看人数</td>
    </tr>
    <tr>
        <td rowspan="3" align="center">moviebl.searchMovieByKeyword</td>
        <td>语法</td>
        <td>public MovieList searchMovieByKeyword(String keyword);</td>
    </tr>
    <tr>
        <td>前置条件</td>
        <td>无</td>
    </tr>
    <tr>
        <td>后置条件</td>
        <td>返回搜索结果</td>
    </tr>
</table>




<table>
    <tr>
    <th colspan="2" align="center">moviebl 需要的服务(需接口)</th>
    </tr>
    <tr>
        <td>服务名</td>
        <td>服务</td>
    </tr>
    <tr>
        <td>DatabaseFactory.getMovieData</td>
        <td>得到movie数据库的服务的引用</td>
    </tr>
    <tr>
        <td>MenberDataService.insert(MoviePo po)</td>
        <td>在数据库中插入MoviePo对象</td>
    </tr>
    <tr>
        <td>MenberDataService.find(int id)</td>
        <td>根据ID进行查找单一持久化对象</td>
    </tr>
    <tr>
        <td>MenberDataService.finds(String field,int value)</td>
        <td>根据字段名和值进行查找多个持久化对象</td>
    </tr>
    <tr>
        <td>MenberDataService.delete(MoviePO po)</td>
        <td>删除单一持久化对象</td>
    </tr>
    <tr>
        <td>MenberDataService.update(MoviePo po)</td>
        <td>更新单一持久化对象</td>
    </tr>
</table>




##### 5.3.2.7promotionstrategybl模块的接口规范

|            提供的服务            |          |                                                              |
| :------------------------------: | -------- | ------------------------------------------------------------ |
|  PromotionStrategy.addStrategy   | 语法     | public ResultMessage addStrategy(int targetMoney,int giftMoney) |
|                                  | 前置条件 | 启动一个发布优惠策略环节，所有输入符合规则                   |
|                                  | 后置条件 | 结束此次优惠策略发布的环节，持久化更新涉及的领域对象的数据   |
|  PromotionStrategy.getStrategy   | 语法     | public ResultMessage getStrategy（）                         |
|                                  | 前置条件 | ppromotionStrategy发出获得优惠策略的请求                     |
|                                  | 后置条件 | 返回该用户具有的优惠信息                                     |
| PromotionStrategy.changeStrategy | 语法     | public ResultMessage changeStrategy（long strategyId） |
|                                  | 前置条件 | promotionStrategy发出更改策略的请求           |
|                                  | 后置条件 | 持久化更新涉及的领域对象的数据                               |
| PromotionStrategy.deleteStrategy | 语法     | public ResultMessage deleteStrategy（long strategyId） |
|                                  | 前置条件 | promotionStrategy发出删除策略的请求         |
|                                  | 后置条件 | 持久化更新涉及的领域对象的数据                               |


|                     需要的服务                     |                                    |
| :------------------------------------------------: | ---------------------------------- |
|         PromotionStrategyDataService.find(int id)          | 根据ID进行查找单一持久对象         |
| PromotionStrategyDataService.finds(String field,int value) | 根据字段名和值进行查找多个持久对象 |
|    PromotionStrategyDataService.insert(PromotionPO po)     | 插入单一持久对象                   |
|    PromotionStrategyDataService.delete(PromotionPO po)     | 删除单一持久对象                   |
|    PromotionStrategyDataService.update(PromotionPO po)     | 更新单一持久对象                   |
|        PromotionStrategyDataService.getPromotionDatabase        | 得到Promotion的数据库服务的引用    |
|              User.getCurrentUserId()               | 获得当前用户的ID                   |

##### 5.3.2.8vipHistory模块的接口规范

|            提供的服务            |          |                                                              |
| :------------------------------: | -------- | ------------------------------------------------------------ |
|      vipHistory.getHistory      | 语法     | public ResultMessage getHistory（）                         |
|                                  | 前置条件 | vipHistory发出获得历史纪录的请求                     |
|                                  | 后置条件 | 返回该用户会员卡记录                                    |

|                         需要的服务                         |                                    |
| :--------------------------------------------------------: | ---------------------------------- |
|         vipHistoryDataService.find(int id)          | 根据ID进行查找单一持久对象         |

|     vipHistoryDataService.getHistoryDatabase      | 得到vipHistory的数据库服务的引用    |
|                  User.getCurrentUserId()                   | 获得当前用户的ID                   |

### 5.4数据层分解

#### 5.4.1职责
| 模块|职责 |
|:----:|-------|
|CinemaDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|CinemaDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|CinemaDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|CinemaDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|vipHistoryDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|vipHistorDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|vipHistorDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|vipHistorDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PromotionDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PromotionDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PromotionDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PromotionDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PromotionStrategyDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PromotionStrategyDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PromotionStrategyDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PromotionStrategyDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PurchaseDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PurchaseDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PurchaseDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|PurchaseDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MemberDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MemberDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MemberDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MemberDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MovieDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MovieDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MovieDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MovieDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MovieDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MovieDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MovieDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|MovieDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|UserDataService |持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|UserDataServiceTxtFileImpl|基于Txt文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|UserDataSeviceSerializableFileImpl|基于序列化文件的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|
|UserDataServiceMySqlImpl|基于MySql数据库的持久化数据库的接口，提供集体载入，集体保存，增，删，改，查服务|




#### 5.4.2接口规范
|提供的服务（供接口）|         |        |
| :--------------: | --------|------- |
| CinemaDataService.find|语法|public CinemaPO find(long id) throws RemoteException|
||前置条件| 无|
||后置条件|按ID进行查找返回相应的CinemaPO结果|
|CinemaDataService.insert|语法|public void insert(CinemaPo ) throws RemoteException|
||前置条件| 同样ID的po在Mapper中不存在|
||后置条件|在数据库中增加一个po记录|
|CinemaDataService.delete|语法|public void delete(CinemaPo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|删除一个po|
|CinemaDataService.update|语法|public void updata(CinemaPo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|更新一个po|
|CinemaDataService.init|语法|public void init() throws RemoteException|
||前置条件|无|
||||后置条件|初始化持久化数据库|
|CinemaDataService.finish|语法|public void finish() throws RemoteException|
||前置条件|无|
||后置条件|结束持久化数据库的使用|
| vipHistoryDataService.find|语法|public VipHistoryPO find(long id) throws RemoteException|
||前置条件| 无|
||后置条件|按ID进行查找返回相应的CinemaPO结果|
|PromotionDataService.find|语法|public PromotionPO find(long id) throws RemoteException|
||前置条件|无|
||后置条件|按ID进行查找返回相应的PromotionPO结果|
|PromotionDataService.insert|语法|public void insert(PromotionPo ) throws RemoteException|
||前置条件|同样ID的po在Mapper中不存在|
||后置条件|在数据库中增加一个po记录|
|PromotionDataService.delete|语法|public void delete(PromotionPo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|删除一个po|
|PromotionDataService.update|语法|public void updata(PromotionPo ) throws RemoteException||前置条件|在数据库中存在同样ID的po|
||后置条件|更新一个po|
|PromotionDataService.init|语法|public void init() throws RemoteException|
||前置条件|无|
||后置条件|初始化持久化数据库|
|PromotionDataService.finish|语法|public void finish() throws RemoteException|
||前置条件|无||||
||后置条件|结束持久化数据库的使用|||
|PromotionDataService.find|语法|public PromotionPO find(long id) throws RemoteException|
||前置条件|无|
||后置条件|按ID进行查找返回相应的PromotionPO结果|
|PromotionStrategyDataService.insert|语法|public void insert(PromotionPo ) throws RemoteException|
||前置条件|同样ID的po在Mapper中不存在|
||后置条件|在数据库中增加一个po记录|
|PromotionStrategyDataService.delete|语法|public void delete(PromotionPo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|删除一个po|
|PromotionStrategyDataService.update|语法|public void updata(PromotionPo ) throws RemoteException||前置条件|在数据库中存在同样ID的po|
||后置条件|更新一个po|
|PromotionStrategyDataService.init|语法|public void init() throws RemoteException|
||前置条件|无|
||后置条件|初始化持久化数据库|
|PromotionStrategyDataService.finish|语法|public void finish() throws RemoteException|
||前置条件|无||||
||后置条件|结束持久化数据库的使用|||
|PurchaseDataService.find|语法|public PurchasePO find(long id) throws RemoteException|
||前置条件|无||
||后置条件|按ID进行查找返回相应的PurchasePO结果|
|||PurchaseDataService.insert|语法|public void insert(PurchasePo ) throws RemoteException|
||前置条件|同样ID的po在Mapper中不存在||
||后置条件|在数据库中增加一个po记录|
|PurchaseDataService.delete|语法|public void delete(PurchasePo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|删除一个po|
|PurchaseDataService.update|语法|public void updata(PurchasePo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|更新一个po|
|PurchaseDataService.init|语法|public void init() throws RemoteException|
||前置条件|无|
||后置条件|初始化持久化数据库|
|PurchaseDataService.finish|语法|public void finish() throws RemoteException|
||前置条件|无|
||后置条件|结束持久化数据库的使用|
|MemberDataService.find|语法|public MemberPO find(long id) throws RemoteException|
||前置条件|无|
||后置条件|按ID进行查找返回相应的MemberPO结果|
|MemberDataService.insert|语法|public void insert(MemberPo ) throws RemoteException|
||前置条件|同样ID的po在Mapper中不存在|
||后置条件|在数据库中增加一个po记录|
|MemberDataService.delete|语法|public void delete(MemberPo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|删除一个po|
|MemberDataService.update|语法|public void updata(MemberPo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|更新一个po|
|MemberDataService.init|语法|public void init() throws RemoteException|
||前置条件|无|
||后置条件|初始化持久化数据库|
|MemberDataService.finish|语法|public void finish() throws RemoteException|
||前置条件|无|
||后置条件|结束持久化数据库的使用|
|MenberDataService.find|语法|public MoviePO find(long id) throws RemoteException|
||前置条件|无|
||后置条件|按ID进行查找返回相应的MoviePO结果|
|MenberDataService.insert|语法|public void insert(MoviePo ) throws RemoteException|
||前置条件|同样ID的po在Mapper中不存在|
||后置条件|在数据库中增加一个po记录|
|MenberDataService.delete|语法|public void delete(MoviePo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|删除一个po|
|MenberDataService.update|语法|public void updata(MoviePo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|更新一个po|
|MenberDataService.init|语法|public void init() throws RemoteException|
||前置条件|无|
||后置条件|初始化持久化数据库|
|MenberDataService.finish|语法|public void finish() throws RemoteException|
||前置条件|无|
||后置条件|结束持久化数据库的使用|
|UserDataService.find|语法|public UserPO find(long id) throws RemoteException|
||前置条件|无|
||后置条件|按ID进行查找返回相应的UserPO结果|
|UserDataService.insert|语法|public void insert(UserPo ) throws RemoteException|
||前置条件|同样ID的po在Mapper中不存在|
||后置条件|在数据库中增加一个po记录|
|UserDataService.delete|语法|public void delete(UserPo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|删除一个po|
|UserDataService.update|语法|public void updata(UserPo ) throws RemoteException|
||前置条件|在数据库中存在同样ID的po|
||后置条件|更新一个po|
|UserDataService.init|语法|public void init() throws RemoteException|
||前置条件|无|
||后置条件|初始化持久化数据库|
|UserDataService.finish|语法|public void finish() throws RemoteException|
||前置条件|无|
||后置条件|结束持久化数据库的使用|



### 6.信息视角

#### 6.1描述数据持久化对象(PO)
* UserPO类包含用户的用户名，密码属性。
* PromotionStrategyPO类包含优惠策略的满减价格以及id属性。
* vipHistoryPO类包含会员卡id，消费/充值记录的id，类型，会员卡变更金额属性。
* CinemaPO类包含影厅的编号，名称，座位信息，影厅排片电影列表，每场次电影的价格。

    public class CinemaPO{
    long id;
    long MovieID;
    double MoviePrice;
    Map<String, List<Integer>> cinemaMap;
    List<Integer> Seat;

    public CinemaPO(long i,  Map<String,List<Integer>> m, List<Integer> S ){
    id=i;
    cinemaMap=m;
    MovieID=0;
    MoviePrice=0;
    Seat=S;
    }

    public long getID(){
    return id;
    }

    public Map<String, List<Integer>> getMap(){
        return cinemaMap;
    }

    public long getMovieID(String date){
        for(String key: cinemaMap.keySet()){
            if (date.equals(key)){
            MovieID= (long) cinemaMap.get(key).get(0);
    }
    }
        return MovieID;
    }

    public double getPrice(String date){
        for(String key: cinemaMap.keySet()){
            if (date.equals(key)){
            MoviePrice= (double) cinemaMap.get(key).get(1);
    }
    }
    return MoviePrice;   
    } 

    public List<Integer> getSeat(String date){
        ArrayList<Integer> array=new ArrayList<Integer>();
            for(String key: cinemaMap.keySet()){
                if (date.equals(key)){
                array=(ArrayList<Integer>) cinemaMap.get(key);
            for(int i=0;i < array.size();i++){
                if(i>1){
                    Seat.add((Integer) array.get(i));
	    		    }
    	        }
            }
        }
    return Seat;    
    }
    }


* MoviePO类包含影片的编号，名称，时间，演员，简介，海报，导演，喜爱人数，语言，长度，统计信息。

* PromotionPO类：包含优惠活动的编号，进行时间区间，优惠券的使用有效期，优惠金额，参与条件，持有这项优惠券的用户列表
* PurchasePo类：包含一次购票行为中的信息，包括编号，购票用户ID，价格，座位信息，时间信息，影片信息。
* MemberPO类：包含会员的编号，用户ID,密码，会员卡余额。
* StatisticInformationPo类：包含各类统计信息，有近期最受欢迎电影，上座率，客单价，票房，排片率。

#### 6.2Txt 持久化格式

Txt数据保持格式以Movie.txt为例，每行分别对应电影id，电影名称，电影想看人数，电影上映时间等，中间用“#”隔开。如下所示|

001#钢铁侠1#56#2019/4/20/0:00#...

#### 6.3数据库表

数据库中包含User表，Movie表，Member表，purchase表，Movie-List表，Purchase-Promotion表，Movie-Like表，Movie-Message表，Cinema表。

